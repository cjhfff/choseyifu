<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Supabase è¿æ¥æµ‹è¯•</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-card {
            background: white;
            padding: 20px;
            margin: 10px 0;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .test-card h3 {
            margin-top: 0;
            color: #333;
        }
        .status {
            display: inline-block;
            padding: 5px 10px;
            border-radius: 4px;
            font-size: 14px;
            font-weight: bold;
        }
        .success { background: #4caf50; color: white; }
        .error { background: #f44336; color: white; }
        .warning { background: #ff9800; color: white; }
        .pending { background: #2196f3; color: white; }
        pre {
            background: #f5f5f5;
            padding: 10px;
            border-radius: 4px;
            overflow-x: auto;
        }
        button {
            background: #2196f3;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            margin: 5px;
        }
        button:hover {
            background: #1976d2;
        }
    </style>
</head>
<body>
    <h1>â˜ï¸ Supabase è¿æ¥æµ‹è¯•</h1>
    
    <div class="test-card">
        <h3>1. Supabase SDK åŠ è½½</h3>
        <div id="sdk-status" class="status pending">æ£€æŸ¥ä¸­...</div>
        <pre id="sdk-info"></pre>
    </div>
    
    <div class="test-card">
        <h3>2. Storage æ¨¡å—åˆå§‹åŒ–</h3>
        <div id="storage-status" class="status pending">æ£€æŸ¥ä¸­...</div>
        <pre id="storage-info"></pre>
    </div>
    
    <div class="test-card">
        <h3>3. æ•°æ®åº“è¿æ¥æµ‹è¯•</h3>
        <div id="db-status" class="status pending">ç­‰å¾…æµ‹è¯•...</div>
        <button onclick="testDatabase()">æµ‹è¯•æ•°æ®åº“</button>
        <pre id="db-info"></pre>
    </div>
    
    <div class="test-card">
        <h3>4. Storage Bucket æµ‹è¯•</h3>
        <div id="bucket-status" class="status pending">ç­‰å¾…æµ‹è¯•...</div>
        <button onclick="testBucket()">æµ‹è¯• Bucket</button>
        <pre id="bucket-info"></pre>
    </div>
    
    <div class="test-card">
        <h3>5. è·å–å­˜å‚¨ä¿¡æ¯</h3>
        <div id="info-status" class="status pending">ç­‰å¾…æµ‹è¯•...</div>
        <button onclick="testGetInfo()">æµ‹è¯• getStorageInfo</button>
        <pre id="info-result"></pre>
    </div>

    <!-- å¼•å…¥ Supabase SDK -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    
    <!-- å¼•å…¥ storage.js -->
    <script src="js/storage.js"></script>
    
    <script>
        // æµ‹è¯• 1: SDK åŠ è½½
        setTimeout(() => {
            const sdkStatus = document.getElementById('sdk-status');
            const sdkInfo = document.getElementById('sdk-info');
            
            if (typeof window.supabase !== 'undefined') {
                sdkStatus.className = 'status success';
                sdkStatus.textContent = 'âœ… åŠ è½½æˆåŠŸ';
                sdkInfo.textContent = 'Supabase SDK ç‰ˆæœ¬: ' + (window.supabase.version || '2.x');
            } else {
                sdkStatus.className = 'status error';
                sdkStatus.textContent = 'âŒ åŠ è½½å¤±è´¥';
                sdkInfo.textContent = 'Supabase SDK æœªæ‰¾åˆ°';
            }
        }, 1000);
        
        // æµ‹è¯• 2: Storage æ¨¡å—
        setTimeout(() => {
            const storageStatus = document.getElementById('storage-status');
            const storageInfo = document.getElementById('storage-info');
            
            if (typeof storage !== 'undefined') {
                storageStatus.className = 'status success';
                storageStatus.textContent = 'âœ… åˆå§‹åŒ–æˆåŠŸ';
                storageInfo.textContent = JSON.stringify({
                    bucketName: storage.bucketName,
                    tableName: storage.tableName,
                    outfitsTableName: storage.outfitsTableName
                }, null, 2);
            } else {
                storageStatus.className = 'status error';
                storageStatus.textContent = 'âŒ åˆå§‹åŒ–å¤±è´¥';
                storageInfo.textContent = 'storage å¯¹è±¡æœªæ‰¾åˆ°';
            }
        }, 1500);
        
        // æµ‹è¯• 3: æ•°æ®åº“è¿æ¥
        async function testDatabase() {
            const dbStatus = document.getElementById('db-status');
            const dbInfo = document.getElementById('db-info');
            
            dbStatus.className = 'status pending';
            dbStatus.textContent = 'â³ æµ‹è¯•ä¸­...';
            
            try {
                const { data, error } = await supabase
                    .from('clothes')
                    .select('count', { count: 'exact', head: true });
                
                if (error) throw error;
                
                dbStatus.className = 'status success';
                dbStatus.textContent = 'âœ… è¿æ¥æˆåŠŸ';
                dbInfo.textContent = 'æ•°æ®åº“è¡¨ "clothes" å­˜åœ¨ä¸”å¯è®¿é—®\n' + 
                                    'å½“å‰è®°å½•æ•°: ' + (data?.length || 0);
            } catch (error) {
                dbStatus.className = 'status error';
                dbStatus.textContent = 'âŒ è¿æ¥å¤±è´¥';
                dbInfo.textContent = 'é”™è¯¯ä¿¡æ¯:\n' + JSON.stringify(error, null, 2) + 
                                    '\n\nå¯èƒ½åŸå› :\n' +
                                    '1. è¡¨ "clothes" ä¸å­˜åœ¨\n' +
                                    '2. RLS ç­–ç•¥æœªé…ç½®\n' +
                                    '3. API Key é”™è¯¯';
            }
        }
        
        // æµ‹è¯• 4: Storage Bucket
        async function testBucket() {
            const bucketStatus = document.getElementById('bucket-status');
            const bucketInfo = document.getElementById('bucket-info');
            
            bucketStatus.className = 'status pending';
            bucketStatus.textContent = 'â³ æµ‹è¯•ä¸­...';
            
            try {
                const { data, error } = await supabase
                    .storage
                    .getBucket('cloth-images');
                
                if (error) throw error;
                
                bucketStatus.className = 'status success';
                bucketStatus.textContent = 'âœ… Bucket å­˜åœ¨';
                bucketInfo.textContent = 'Bucket ä¿¡æ¯:\n' + JSON.stringify(data, null, 2);
            } catch (error) {
                bucketStatus.className = 'status error';
                bucketStatus.textContent = 'âŒ Bucket ä¸å­˜åœ¨';
                bucketInfo.textContent = 'é”™è¯¯ä¿¡æ¯:\n' + JSON.stringify(error, null, 2) + 
                                       '\n\nè¯·åœ¨ Supabase Dashboard åˆ›å»ºåä¸º "cloth-images" çš„ Bucket';
            }
        }
        
        // æµ‹è¯• 5: getStorageInfo
        async function testGetInfo() {
            const infoStatus = document.getElementById('info-status');
            const infoResult = document.getElementById('info-result');
            
            infoStatus.className = 'status pending';
            infoStatus.textContent = 'â³ æµ‹è¯•ä¸­...';
            
            try {
                const info = await storage.getStorageInfo();
                
                infoStatus.className = 'status success';
                infoStatus.textContent = 'âœ… è·å–æˆåŠŸ';
                infoResult.textContent = JSON.stringify(info, null, 2);
            } catch (error) {
                infoStatus.className = 'status error';
                infoStatus.textContent = 'âŒ è·å–å¤±è´¥';
                infoResult.textContent = 'é”™è¯¯ä¿¡æ¯:\n' + error.message + '\n' + error.stack;
            }
        }
        
        // è‡ªåŠ¨è¿è¡ŒåŸºç¡€æµ‹è¯•
        console.log('ğŸ§ª å¼€å§‹è‡ªåŠ¨æµ‹è¯•...');
    </script>
</body>
</html>
